# 外键约束问题修复指南

## 问题
您遇到"profiles_user_id_fkey"外键约束错误，这是因为 profiles 表中的 user_id 引用的用户不存在。

## 解决方案

### 立即执行以下步骤：

1. **打开 Supabase Dashboard**
2. **进入 SQL Editor**
3. **复制并执行 `fix_foreign_key.sql` 脚本**

### 这个脚本会：

1. **检查当前状态** - 查看用户和资料数据
2. **检查外键约束** - 查看约束关系
3. **临时禁用外键约束** - 移除有问题的约束
4. **重新创建约束** - 设置正确的外键关系
5. **创建测试数据** - 确保数据完整性
6. **验证修复** - 确认问题解决

### 执行后您应该看到：

- ✅ 用户和资料数据统计
- ✅ 外键约束信息
- ✅ 测试数据创建成功
- ✅ "外键约束修复完成" 的确认消息

### 如果仍有问题：

如果执行脚本后仍有外键约束问题，可以：

1. **临时禁用外键约束**：
```sql
ALTER TABLE profiles DROP CONSTRAINT IF EXISTS profiles_user_id_fkey;
```

2. **或者创建允许 NULL 的约束**：
```sql
ALTER TABLE profiles ALTER COLUMN user_id DROP NOT NULL;
```

### 验证修复：

1. **重新尝试创建用户资料**
2. **应该不再出现外键约束错误**
3. **可以正常保存数据**

### 预防措施：

为了避免将来出现类似问题：

1. **确保用户存在后再创建资料**
2. **使用正确的外键关系**
3. **定期检查数据完整性**
4. **测试所有数据库操作**

修复完成后，您的应用应该能够正常创建用户资料了！
