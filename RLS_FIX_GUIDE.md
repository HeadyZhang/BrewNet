# RLS 权限问题修复指南

## 问题
您遇到"new row violates row-level security policy"错误，这是行级安全策略的权限问题。

## 解决方案

### 立即执行以下步骤：

1. **打开 Supabase Dashboard**
2. **进入 SQL Editor**
3. **复制并执行 `fix_rls_policies.sql` 脚本**

### 脚本会做什么：

1. **检查当前策略** - 查看现有的 RLS 策略
2. **删除旧策略** - 移除有问题的策略
3. **创建新策略** - 设置更宽松的权限策略
4. **修复 users 表** - 同时修复 users 表的策略
5. **验证修复** - 确认策略设置正确

### 执行后您应该看到：

- ✅ 策略检查结果
- ✅ 新策略创建成功
- ✅ 认证状态信息
- ✅ "RLS 策略修复完成" 的确认消息

### 如果仍有问题：

如果执行脚本后仍有权限问题，可以临时禁用 RLS：

```sql
-- 临时禁用 RLS（仅用于测试）
ALTER TABLE profiles DISABLE ROW LEVEL SECURITY;
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
```

**注意：** 禁用 RLS 会降低安全性，仅用于测试目的。

### 验证修复：

1. **重新尝试创建用户资料**
2. **应该不再出现权限错误**
3. **可以正常保存数据**

### 预防措施：

为了避免将来出现类似问题：

1. **使用正确的 RLS 策略**
2. **确保用户已正确认证**
3. **定期检查权限设置**
4. **测试所有数据库操作**

修复完成后，您的应用应该能够正常创建用户资料了！
